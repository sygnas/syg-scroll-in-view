{"version":3,"file":"syg-scroll-inview.min.js","sources":["../node_modules/syg-throttle/src/index.js","../src/index.js"],"sourcesContent":["\nexport default function (timing, func, scope) {\n    let id = null;\n\n    return function () {\n        if (id !== null) return;\n        func.apply(scope);\n\n        id = setTimeout(function () {\n            id = null;\n        }, timing);\n    };\n}","/**\n * Scroll in viewport add data attribute\n * スクロールしてビューポートに入ったらdata属性を与える\n *\n * @author   Hiroshi Fukuda <info.sygnas@gmail.com>\n * @license  MIT\n */\n\nimport throttle from 'syg-throttle';\n\n\n// デフォルト値\nconst defaults = {\n    offset: 50,\n    doc_bottom_offset: 50,\n    on_view: function() {}\n};\n\nconst ATTR_INVIEW = 'data-inview';\nconst ATTR_INVIEW_OFFSET = 'data-inview-offset';\n\n\n/**\n * エレメント情報を格納したクラス\n */\nclass TargetClass {\n    constructor(elm) {\n        // ビューポートに入ったかチェックするエレメント\n        this.elm = elm;\n        // ビューポートの判定オフセット\n        this.offset = 0;\n        // ドキュメント内の座標\n        this.top = 0;\n        // ドキュメント内の座標＋エレメント高さ\n        this.bottom = 0;\n        // 表示したか\n        this.is_inview = false;\n    }\n}\n\n\n/**\n * in view controller\n */\nexport default class {\n\n    /**\n     * コンストラクタ\n     * @param {string} target DOM selector string\n     * @param {object} config\n     */\n    constructor(target, config) {\n\n        this.opt = Object.assign(defaults, config);\n        // 対象エレメントのセレクタ文字列\n        this.target_string = target;\n        // 対象エレメントと、座標を格納したリスト\n        this.target_list = [];\n        // 開始したか\n        this.is_started = false;\n        // ウィンドウの高さ\n        this.win_height = 0;\n        // ドキュメント全体の高さ\n        this.doc_height = 0;\n        // 対象エレメントの高さをチェックするための setInterval ID\n        this.interval_id = null;\n        // スクロールイベント\n        this.ev_scroll = null;\n        // リサイズイベント\n        this.ev_resize = null;\n\n        // ターゲットエレメントを取得\n        this.reset_target();\n    }\n\n    /**\n     * ターゲットエレメントを取得\n     * エレメント、top座標、bottom座標を格納したクラスの配列を作る\n     * @public\n     */\n    reset_target() {\n        const opt = this.opt;\n        this.target_list = [];\n\n        const node_list = document.querySelectorAll(this.target_string);\n\n        get_node_array(node_list).forEach((elm) => {\n            const target = new TargetClass(elm);\n            const offset = Number.parseInt(elm.getAttribute(ATTR_INVIEW_OFFSET), 10);\n            target.offset =  offset || opt.offset;\n            this.target_list.push(target);\n        });\n    }\n\n    /**\n     * スクロール検知処理を開始\n     * @public\n     */\n    start() {\n\n        // すでに開始していたら無視\n        if (this.is_started) return;\n\n        // 各アイテムの高さをチェック\n        this.$_check_element_position();\n\n        // ウィンドウ、ドキュメントの高さをチェック\n        this.ev_resize = throttle(50, this.$_check_document_height, this);\n        window.addEventListener('resize', this.ev_resize);\n        this.$_check_document_height();\n\n        // スクロールイベント\n        this.ev_scroll = throttle(40, this.$_check_inview, this);\n        window.addEventListener('scroll', this.ev_scroll);\n        this.$_check_inview();\n\n        this.is_started = true;\n    }\n\n    /**\n     * ビューポート判定を全て停める\n     * @public\n     */\n    stop() {\n        window.removeEventListener('scroll', this.ev_scroll);\n        window.removeEventListener('resize', this.ev_resize);\n        this.is_started = false;\n    }\n\n\n    /**\n     * プライベートメソッド\n     */\n\n    /**\n     * 対象エレメントの上下座標をチェックして、this.target_list のオブジェクトを更新\n     */\n    $_check_element_position() {\n        this.target_list.forEach((target) => {\n            const elm = target.elm;\n            const scroll_top = window.pageYOffset;\n            const rect = elm.getBoundingClientRect();\n            target.top = scroll_top + rect.top;\n            target.bottom = scroll_top + rect.bottom;\n        });\n    }\n\n    /**\n    * ウィンドウをリサイズしたら高さなどをチェック\n    */\n    $_check_document_height() {\n        this.win_height = window.window.innerHeight;\n        this.doc_height = document.documentElement.scrollHeight;\n    }\n\n    /**\n     * スクロール処理\n     * 各エレメントが画面内に存在するか\n     */\n    $_check_inview() {\n        let is_all_inview = true;\n\n        // スクロール上位置と下位置\n        const scroll_top = window.pageYOffset;\n        const scroll_bottom = scroll_top + this.win_height;\n\n        // 場面下端までいったら強制的に全部表示して、scroll処理を止める\n        if(this.$_check_arrived_document_bottom(scroll_bottom)) {\n            return;\n        }\n\n        // 対象エレメントを順にチェック\n        // 全てのエレメントが表示されたら is_all_inview が true になる\n        this.target_list.forEach((target) => {\n            is_all_inview =\n                this.$_check_inview_target(target, scroll_top, scroll_bottom)\n                && is_all_inview;\n        });\n\n        // 全てのエレメントが表示されたら処理を止める\n        if(is_all_inview) this.stop();\n    }\n\n    /**\n     * ドキュメント下端までスクロールしたら、強制的に全表示。\n     * スクロール検知も止める\n     * @param {Number} scroll_bottom 画面の下端座標\n     * @return {Boolean} 画面下端までスクロールしたら ture を返す\n     */\n    $_check_arrived_document_bottom(scroll_bottom) {\n        if(scroll_bottom >= this.doc_height - this.opt.doc_bottom_offset) {\n\n            this.target_list.forEach((target) => {\n                this.$_set_target_visible(target, true);\n            });\n            this.stop();\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * 指定されたターゲットエレメントがビューポートにあるかチェック\n     * @param {Object} target エレメント、上下座標を格納したオブジェクト\n     * @param {Number} scroll_top ウィンドウのスクロール座標上辺\n     * @param {Number} scroll_bottom ウィンドウのスクロール座標下辺\n     * @return {Boolean} ビューポートに入って表示したら true を返す\n     */\n    $_check_inview_target(target, scroll_top, scroll_bottom) {\n        // すでにビューポートに入って表示されていたら無視\n        if (target.is_inview) return true;\n\n        // 画面内に入っていたら、通り過ぎていたら data-inview=\"true\" にする\n        if (target.top + target.offset <= scroll_bottom) {\n            this.$_set_target_visible(target, true);\n        }\n\n        return target.is_inview;\n    }\n\n    /**\n     * ターゲットエレメントの表示・非表示切り替え\n     * @param {*} TargetClass ターゲットクラス\n     * @param {*} bool 表示は true / 非表示は false\n     */\n    $_set_target_visible(target, bool) {\n        target.elm.setAttribute(ATTR_INVIEW, bool ? 'true' : 'false');\n        target.is_inview = bool;\n    }\n}\n\n\n/**\n * NodeListをArrayとして取り出す（IE対策）\n */\nfunction get_node_array(node_list) {\n    return Array.prototype.slice.call(node_list, 0);\n}\n\n"],"names":["timing","func","scope","id","apply","setTimeout","defaults","target","config","opt","Object","assign","target_string","target_list","is_started","win_height","doc_height","interval_id","ev_scroll","ev_resize","reset_target","this","node_list","Array","prototype","slice","call","document","querySelectorAll","forEach","elm","offset","top","bottom","is_inview","Number","parseInt","getAttribute","push","$_check_element_position","throttle","$_check_document_height","addEventListener","$_check_inview","removeEventListener","scroll_top","window","pageYOffset","rect","getBoundingClientRect","innerHeight","documentElement","scrollHeight","is_all_inview","scroll_bottom","$_check_arrived_document_bottom","_this2","$_check_inview_target","stop","doc_bottom_offset","$_set_target_visible","bool","setAttribute"],"mappings":"gMACA,MAAe,SAAUA,EAAQC,EAAMC,OAC/BC,EAAK,YAEF,WACQ,OAAPA,MACCC,MAAMF,KAENG,WAAW,aACP,MACNL,0VCELM,UACM,qBACW,WACV,2CAoCGC,EAAQC,kBAEXC,IAAMC,OAAOC,OAAOL,EAAUE,QAE9BI,cAAgBL,OAEhBM,oBAEAC,YAAa,OAEbC,WAAa,OAEbC,WAAa,OAEbC,YAAc,UAEdC,UAAY,UAEZC,UAAY,UAGZC,2EASCX,EAAMY,KAAKZ,SACZI,gBAsJb,SAGwBS,UACbC,MAAMC,UAAUC,MAAMC,KAAKJ,EAAW,KAxJvBK,SAASC,iBAAiBP,KAAKT,gBAEvBiB,QAAQ,SAACC,OACzBvB,EAAS,IA7DvB,WAAYuB,kBAEHA,IAAMA,OAENC,OAAS,OAETC,IAAM,OAENC,OAAS,OAETC,WAAY,EAmDE,CAAgBJ,GACzBC,EAASI,OAAOC,SAASN,EAAIO,aArEpB,sBAqEsD,MAC9DN,OAAUA,GAAUtB,EAAIsB,SAC1BlB,YAAYyB,KAAK/B,qCAWtBc,KAAKP,kBAGJyB,gCAGApB,UAAYqB,EAAS,GAAInB,KAAKoB,wBAAyBpB,aACrDqB,iBAAiB,SAAUrB,KAAKF,gBAClCsB,+BAGAvB,UAAYsB,EAAS,GAAInB,KAAKsB,eAAgBtB,aAC5CqB,iBAAiB,SAAUrB,KAAKH,gBAClCyB,sBAEA7B,YAAa,yCAQX8B,oBAAoB,SAAUvB,KAAKH,kBACnC0B,oBAAoB,SAAUvB,KAAKF,gBACrCL,YAAa,0DAYbD,YAAYgB,QAAQ,SAACtB,OAChBuB,EAAMvB,EAAOuB,IACbe,EAAaC,OAAOC,YACpBC,EAAOlB,EAAImB,0BACVjB,IAAMa,EAAaG,EAAKhB,MACxBC,OAASY,EAAaG,EAAKf,gEAQjClB,WAAa+B,OAAOA,OAAOI,iBAC3BlC,WAAaW,SAASwB,gBAAgBC,iEAQvCC,GAAgB,EAGdR,EAAaC,OAAOC,YACpBO,EAAgBT,EAAaxB,KAAKN,WAGrCM,KAAKkC,gCAAgCD,UAMnCzC,YAAYgB,QAAQ,SAACtB,KAElBiD,EAAKC,sBAAsBlD,EAAQsC,EAAYS,IAC5CD,IAIRA,GAAehC,KAAKqC,gEASKJ,qBACzBA,GAAiBjC,KAAKL,WAAaK,KAAKZ,IAAIkD,yBAEtC9C,YAAYgB,QAAQ,SAACtB,KACjBqD,qBAAqBrD,GAAQ,UAEjCmD,QACE,iDAYOnD,EAAQsC,EAAYS,WAElC/C,EAAO2B,YAGP3B,EAAOyB,IAAMzB,EAAOwB,QAAUuB,QACzBM,qBAAqBrD,GAAQ,GAG/BA,EAAO2B,wDAQG3B,EAAQsD,KAClB/B,IAAIgC,aAhNC,cAgNyBD,EAAO,OAAS,WAC9C3B,UAAY2B"}